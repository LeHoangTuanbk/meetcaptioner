var content=(function(){"use strict";function I(t){return t}function o(t){return new Promise((n,e)=>{try{chrome.runtime.sendMessage(t,r=>{chrome.runtime.lastError&&console.debug("[MeetCaptioner] Message send error:",chrome.runtime.lastError.message),n()})}catch(r){console.debug("[MeetCaptioner] Failed to send message:",r),n()}})}function g(t){return o({type:"TRANSCRIPT_UPDATE",payload:t})}const d=new Map,m={matches:["https://meet.google.com/*"],runAt:"document_start",world:"ISOLATED",main(){if(console.debug("[MeetCaptioner] Content script loaded"),!/\/[a-z]{3}-[a-z]{4}-[a-z]{3}($|\?)/.test(window.location.pathname)&&window.location.pathname!=="/new"){console.debug("[MeetCaptioner] Not a meeting URL, skipping injection");return}h(),console.log("[MeetCaptioner] Setting up postMessage listener"),window.addEventListener("message",n=>{if(n.data?.source!=="meetcaptioner")return;const e=n.data;switch(console.warn("[MeetCaptioner] RECEIVED:",e.type,e.messages?.[0]?.text||e.connected),e.type){case"speech":Array.isArray(e.messages)&&e.messages.forEach(r=>{const i={messageId:r.messageId||`msg_${Date.now()}`,speakerId:r.deviceId||"unknown",speakerName:r.deviceName||d.get(r.deviceId)||r.deviceId||"Unknown",text:r.text||"",timestamp:Date.now(),isFinal:r.type==="chat"};i.text&&(console.warn("[MeetCaptioner] SENDING:",i.speakerName,"-",i.text),g(i))});break;case"deviceinfo":e.deviceId&&e.deviceName&&(d.set(e.deviceId,e.deviceName),console.debug("[MeetCaptioner] Device:",e.deviceId,"=",e.deviceName));break;case"premeeting-devices":Array.isArray(e.devices)&&(e.devices.forEach(r=>{r.deviceId&&r.deviceName&&d.set(r.deviceId,r.deviceName)}),console.debug("[MeetCaptioner] Loaded",e.devices.length,"devices"));break;case"status":o({type:"CONNECTION_STATUS",payload:{connected:e.connected}}),console.debug("[MeetCaptioner] Status:",e.connected?"connected":"disconnected");break;case"language-changed":console.debug("[MeetCaptioner] Language changed:",e);break}}),o({type:"MEETING_STARTED",payload:{meetingId:window.location.pathname}}),window.addEventListener("beforeunload",()=>{o({type:"MEETING_ENDED"})})}};function h(){if(document.querySelector('meta[name="meetcaptioner-injected"]')){console.debug("[MeetCaptioner] Already injected");return}const t=document.createElement("script");t.src=chrome.runtime.getURL("injected.js"),t.type="text/javascript";const n=document.head||document.documentElement;t.onload=()=>{console.debug("[MeetCaptioner] Injected script loaded"),t.remove()},t.onerror=e=>{console.error("[MeetCaptioner] Failed to inject script:",e)},n.prepend(t)}const p=globalThis.browser?.runtime?.id?globalThis.browser:globalThis.chrome;function s(t,...n){}const v={debug:(...t)=>s(console.debug,...t),log:(...t)=>s(console.log,...t),warn:(...t)=>s(console.warn,...t),error:(...t)=>s(console.error,...t)};class l extends Event{constructor(n,e){super(l.EVENT_NAME,{}),this.newUrl=n,this.oldUrl=e}static EVENT_NAME=u("wxt:locationchange")}function u(t){return`${p?.runtime?.id}:content:${t}`}function w(t){let n,e;return{run(){n==null&&(e=new URL(location.href),n=t.setInterval(()=>{let r=new URL(location.href);r.href!==e.href&&(window.dispatchEvent(new l(r,e)),e=r)},1e3))}}}class a{constructor(n,e){this.contentScriptName=n,this.options=e,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}static SCRIPT_STARTED_MESSAGE_TYPE=u("wxt:content-script-started");isTopFrame=window.self===window.top;abortController;locationWatcher=w(this);receivedMessageIds=new Set;get signal(){return this.abortController.signal}abort(n){return this.abortController.abort(n)}get isInvalid(){return p.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(n){return this.signal.addEventListener("abort",n),()=>this.signal.removeEventListener("abort",n)}block(){return new Promise(()=>{})}setInterval(n,e){const r=setInterval(()=>{this.isValid&&n()},e);return this.onInvalidated(()=>clearInterval(r)),r}setTimeout(n,e){const r=setTimeout(()=>{this.isValid&&n()},e);return this.onInvalidated(()=>clearTimeout(r)),r}requestAnimationFrame(n){const e=requestAnimationFrame((...r)=>{this.isValid&&n(...r)});return this.onInvalidated(()=>cancelAnimationFrame(e)),e}requestIdleCallback(n,e){const r=requestIdleCallback((...i)=>{this.signal.aborted||n(...i)},e);return this.onInvalidated(()=>cancelIdleCallback(r)),r}addEventListener(n,e,r,i){e==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),n.addEventListener?.(e.startsWith("wxt:")?u(e):e,r,{...i,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),v.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:a.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(n){const e=n.data?.type===a.SCRIPT_STARTED_MESSAGE_TYPE,r=n.data?.contentScriptName===this.contentScriptName,i=!this.receivedMessageIds.has(n.data?.messageId);return e&&r&&i}listenForNewerScripts(n){let e=!0;const r=i=>{if(this.verifyScriptStartedEvent(i)){this.receivedMessageIds.add(i.data.messageId);const f=e;if(e=!1,f&&n?.ignoreFirstEvent)return;this.notifyInvalidated()}};addEventListener("message",r),this.onInvalidated(()=>removeEventListener("message",r))}}function S(){}function c(t,...n){}const E={debug:(...t)=>c(console.debug,...t),log:(...t)=>c(console.log,...t),warn:(...t)=>c(console.warn,...t),error:(...t)=>c(console.error,...t)};return(async()=>{try{const{main:t,...n}=m,e=new a("content",n);return await t(e)}catch(t){throw E.error('The content script "content" crashed on startup!',t),t}})()})();
content;