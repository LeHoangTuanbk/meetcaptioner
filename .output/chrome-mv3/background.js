var background=(function(){"use strict";function s(e){return e==null||typeof e=="function"?{main:e}:e}async function i(){return(await chrome.storage.local.get("transcripts")).transcripts||[]}async function l(e){await chrome.storage.local.set({transcripts:e})}async function u(e){const t=await i(),o=t.findIndex(c=>c.messageId===e.messageId);o>=0?t[o]=e:t.push(e),t.length>1e3&&t.splice(0,t.length-1e3),await l(t)}async function d(){await chrome.storage.local.remove("transcripts")}const g=s(()=>{console.debug("[MeetCaptioner] Background service worker started");let e=!1,t=null;chrome.runtime.onMessage.addListener((n,m,h)=>{switch(console.debug("[MeetCaptioner] Received message:",n.type),n.type){case"TRANSCRIPT_UPDATE":o(n.payload);break;case"TRANSCRIPT_BATCH":n.payload.forEach(f=>{o(f)});break;case"MEETING_STARTED":t=n.payload.meetingId,console.debug("[MeetCaptioner] Meeting started:",t),d();break;case"MEETING_ENDED":console.debug("[MeetCaptioner] Meeting ended"),t=null,e=!1;break;case"CONNECTION_STATUS":e=n.payload.connected,console.debug("[MeetCaptioner] Connection status:",e);break}return c(n),h({success:!0}),!0});async function o(n){await u(n)}function c(n){chrome.runtime.sendMessage(n).catch(()=>{})}chrome.action.onClicked.addListener(async n=>{n.id&&(n.url?.includes("meet.google.com")?await chrome.sidePanel.open({tabId:n.id}):console.debug("[MeetCaptioner] Not on Google Meet page"))}),chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0}).catch(()=>{})});function T(){}globalThis.browser?.runtime?.id?globalThis.browser:globalThis.chrome;function r(e,...t){}const p={debug:(...e)=>r(console.debug,...e),log:(...e)=>r(console.log,...e),warn:(...e)=>r(console.warn,...e),error:(...e)=>r(console.error,...e)};let a;try{a=g.main(),a instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(e){throw p.error("The background crashed on startup!"),e}return a})();
